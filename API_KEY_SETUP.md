# 🚀 Claude API 키 설정 - 빠른 가이드

## ✅ 완료된 작업

CareLoop이 **실제 Claude AI**를 사용하도록 설정되었습니다!

- ✅ Claude API 통합 완료
- ✅ 전문 상담사 시스템 프롬프트 작성
- ✅ 한국 치매 지원 제도 정보 포함
- ✅ 에러 처리 및 사용자 안내 추가

## 🔑 API 키 설정 (필수)

### 1단계: API 키 발급

1. **Anthropic Console 접속**
   ```
   https://console.anthropic.com
   ```

2. **회원가입/로그인**
   - GitHub 계정으로 간편 가입 가능
   - 또는 Google 계정 사용

3. **API Keys 메뉴 이동**
   - 좌측 메뉴에서 "API Keys" 선택
   - 또는 직접 링크: https://console.anthropic.com/settings/keys

4. **새 키 생성**
   - "Create Key" 버튼 클릭
   - Key 이름 입력 (예: "CareLoop Development")
   - **생성된 키 복사** (한 번만 표시됨!)

   형식: `sk-ant-api03-...` (매우 긴 문자열)

5. **크레딧 확인**
   - Settings → Billing에서 잔액 확인
   - 새 계정은 테스트용 무료 크레딧 제공
   - 프로덕션 사용 시 결제 정보 등록

### 2단계: 환경 변수 설정

#### Windows

1. **파일 찾기**
   ```
   C:\Users\mjkim\my-app\.env.local
   ```

2. **메모장으로 열기**
   - 파일 우클릭 → "연결 프로그램" → 메모장
   - 또는 명령 프롬프트:
   ```cmd
   notepad C:\Users\mjkim\my-app\.env.local
   ```

3. **API 키 입력**
   ```env
   # Anthropic API Key
   # Get your API key from: https://console.anthropic.com/settings/keys
   ANTHROPIC_API_KEY=sk-ant-api03-여기에_실제_키_붙여넣기
   ```

4. **저장** (Ctrl+S)

#### Mac/Linux

```bash
# 편집기로 열기
nano my-app/.env.local
# 또는
code my-app/.env.local

# API 키 입력 후 저장
```

### 3단계: 서버 재시작

환경 변수 변경 후 **반드시** 서버를 재시작해야 합니다!

```bash
# 1. 현재 실행 중인 서버 중지
Ctrl+C

# 2. 다시 시작
cd my-app
npm run dev
```

### 4단계: 테스트

1. **브라우저 접속**
   ```
   http://localhost:3000
   ```

2. **AI 상담 탭 클릭**

3. **테스트 메시지 입력**

   예시 1:
   ```
   안녕하세요, 어머니가 밤에 자꾸 깨서 나가려고 해요. 어떻게 해야 할까요?
   ```

   예시 2:
   ```
   요즘 너무 힘들어서 견디기가 힘들어요. 가족들은 도와주지 않고...
   ```

   예시 3:
   ```
   어머니가 저를 못 알아보세요. 너무 슬프고 죄책감이 들어요.
   ```

4. **응답 확인**
   - 2-5초 후 Claude의 상세한 응답 표시
   - 공감 + 실천적 조언 + 지원 정보 포함

## 🎯 AI 응답 특징

새로운 시스템 프롬프트로 다음을 제공합니다:

### ✨ 정서적 지원
- 보호자의 감정(피로, 죄책감, 분노 등) 깊이 공감
- "힘드셨겠어요", "그런 감정은 자연스럽습니다" 등

### 💡 실천적 조언
- 구체적이고 즉시 적용 가능한 방법
- 예: "낮 동안 산책을 하고, 오후 2시 이후 카페인을 피하세요"
- 단계별 설명

### 🏥 한국 지원 제도
- **치매안심센터**: 1899-9988, 전국 256개소
- **주간보호센터**: 낮 시간 돌봄
- **단기보호서비스**: 최대 9일
- **노인장기요양보험**: 1577-1000
- **긴급 상담**: 1577-0199

### 🌟 자기돌봄 강조
- 보호자 자신의 건강 우선
- "도움 요청은 약함이 아니라 지혜입니다"
- 정기적 휴식, 역할 분담 권유

## 📊 응답 형식

```
[공감] → [상황 이해] → [구체적 조언] → [지원 정보] → [격려]
```

**길이**: 4-6문단, 200-400자 (한글)
**어조**: 따뜻하고 전문적, 존댓말

## ⚠️ 문제 해결

### "ANTHROPIC_API_KEY가 설정되지 않았습니다"

**원인**: API 키가 입력되지 않았거나 서버가 재시작되지 않음

**해결**:
1. `.env.local` 파일 확인
2. API 키 정확히 입력했는지 확인
3. 서버 재시작 (Ctrl+C → npm run dev)

### "401 Unauthorized" 또는 "invalid x-api-key"

**원인**: API 키가 잘못됨

**해결**:
1. Anthropic Console에서 키 확인
2. 키를 정확히 복사했는지 확인
3. 공백이나 특수문자 없는지 확인
4. 필요시 새 키 생성

### "429 Too Many Requests"

**원인**: API 요청 한도 초과

**해결**:
1. 잠시 기다린 후 재시도 (1-2분)
2. Billing에서 크레딧 확인
3. Rate limit 확인

### 응답이 느림

**정상**: Claude API는 보통 2-5초 소요
- 네트워크 상태에 따라 다름
- 긴 응답일수록 시간 소요
- 타이핑 인디케이터로 대기 중임을 표시

### 응답이 기대와 다름

**시스템 프롬프트 확인**:
```
src/app/api/chat/route.ts
```

- `systemPrompt` 변수 내용 확인
- 필요시 수정 후 서버 재시작

## 💰 비용 정보

### Claude 3.5 Sonnet 요금
- **Input**: $3 / million tokens
- **Output**: $15 / million tokens

### 예상 비용
- **평균 대화 1회**: ~500 tokens = $0.01 미만
- **100회 대화**: 약 $1
- **1,000회 대화**: 약 $10

### 무료 크레딧
- 새 계정: 제한적 크레딧 제공
- 테스트 충분히 가능
- 소진 시 결제 정보 등록

### 비용 절약 팁
1. 대화 히스토리 10개로 제한 (이미 적용됨)
2. 짧은 질문 권장
3. 필요한 경우만 사용

## 📚 추가 문서

- **`SYSTEM_PROMPT_GUIDE.md`**: AI 역할과 기능 상세 설명
- **`CLAUDE_API_SETUP.md`**: 기술적 통합 가이드
- **`SWITCHING_AI_MODE.md`**: 목업 ↔ API 전환 방법

## 🔐 보안 주의사항

### API 키 보호
- ❌ Git에 커밋하지 마세요 (.gitignore에 포함됨)
- ❌ 타인과 공유하지 마세요
- ❌ 공개 저장소에 업로드하지 마세요
- ✅ `.env.local` 파일에만 보관
- ✅ 정기적으로 키 교체 고려

### 프로덕션 배포 시
- Vercel/Netlify 환경 변수로 설정
- 서버 사이드에서만 API 호출 (클라이언트 노출 금지)
- Rate limiting 구현
- 사용량 모니터링

## ✅ 완료 체크리스트

설정을 완료했다면:

- [ ] Anthropic Console 회원가입
- [ ] API 키 생성 및 복사
- [ ] `.env.local` 파일에 키 입력
- [ ] 서버 재시작
- [ ] 브라우저에서 테스트
- [ ] 응답 품질 확인
- [ ] 한국 지원 제도 정보 확인
- [ ] 다양한 시나리오 테스트

## 🎉 다음 단계

### 테스트 시나리오
다양한 상황을 테스트해보세요:

1. **감정 표현**
   - "너무 힘들어요"
   - "화가 나요"
   - "죄책감이 들어요"

2. **문제 행동**
   - "배회해요"
   - "밤에 안 자요"
   - "식사를 거부해요"

3. **지원 요청**
   - "어디서 도움을 받을 수 있나요?"
   - "비용이 너무 많이 들어요"
   - "주간보호센터가 뭔가요?"

4. **자기돌봄**
   - "저도 쉬고 싶어요"
   - "가족이 도와주지 않아요"
   - "우울해요"

### 피드백
- AI 응답이 도움이 되나요?
- 개선할 점이 있나요?
- 추가로 필요한 정보가 있나요?

---

**설정 완료! 이제 실제 Claude AI와 대화하세요.** 🤖✨

문제가 있으면 위 문제 해결 섹션을 참고하거나 이슈를 등록해주세요.
